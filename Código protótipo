<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lembretes de Sa√∫de</title>

<style>
:root {
  --bg: #eef2f5;
  --card: #ffffff;
  --text: #222;
  --primary: #4a90e2;
  --danger: #e63946;
  --warning: #ffb703;
  --radius: 12px;
  --shadow: 0 4px 18px rgba(0,0,0,0.08);
}
.dark {
  --bg: #0d1117;
  --card: #161b22;
  --text: #e6edf3;
  --primary: #4a90e2;
  --danger: #ff5757;
  --warning: #ffca3a;
}
body {
  margin: 0;
  background: var(--bg);
  font-family: "Segoe UI", Arial;
  color: var(--text);
  transition: 0.3s;
}
h2 { text-align: center; margin-top: 15px; font-weight: 600; }
.screen {
  display: none;
  background: var(--card);
  max-width: 430px;
  margin: 25px auto;
  padding: 28px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}
input {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  border-radius: var(--radius);
  border: 1px solid #d0d0d0;
  background: var(--bg);
  color: var(--text);
}
button {
  width: 100%;
  padding: 13px;
  margin-top: 14px;
  border-radius: var(--radius);
  border: none;
  font-size: 16px;
  cursor: pointer;
  font-weight: 600;
}
.btn-primary { background: var(--primary); color: white; }
.btn-danger { background: var(--danger); color: white; }
.btn-edit { background: var(--warning); }
.reminder {
  background: var(--bg);
  padding: 12px;
  border-radius: var(--radius);
  margin-top: 12px;
  border-left: 4px solid var(--primary);
}
.toggle-theme {
  position: fixed;
  top: 15px; right: 15px;
  background: var(--card);
  border-radius: 50%;
  width: 42px; height: 42px;
  display: flex; align-items:center; justify-content:center;
  box-shadow: var(--shadow);
  cursor: pointer;
  font-size: 18px;
}
.password-wrapper { position: relative; }
.show-pass {
  position: absolute;
  right: 12px;
  top: 19px;
  cursor: pointer;
  font-size: 17px;
}
</style>
</head>
<body>

<div class="toggle-theme" onclick="toggleTheme()">üåô</div>

<!-- LOGIN -->
<div id="loginScreen" class="screen" style="display:block;">
<h2>Login</h2>
<div class="password-wrapper">
  <input type="text" id="loginUser" placeholder="Usu√°rio">
</div>
<div class="password-wrapper">
  <input type="password" id="loginPass" placeholder="Senha">
  <span class="show-pass" onclick="togglePassword('loginPass', this)">üëÅ</span>
</div>
<button class="btn-primary" onclick="login()">Entrar</button>
<button onclick="showScreen('registerScreen')">Criar Conta</button>
</div>

<!-- CADASTRO -->
<div id="registerScreen" class="screen">
<h2>Cadastro</h2>
<input type="text" id="regUser" placeholder="Usu√°rio">
<div class="password-wrapper">
  <input type="password" id="regPass" placeholder="Senha">
  <span class="show-pass" onclick="togglePassword('regPass', this)">üëÅ</span>
</div>
<button class="btn-primary" onclick="register()">Cadastrar</button>
<button onclick="showScreen('loginScreen')">Voltar</button>
</div>

<!-- SISTEMA -->
<div id="mainScreen" class="screen">
<h2>Lembretes</h2>
<input type="text" id="tituloLembrete" placeholder="T√≠tulo do lembrete">
<input type="datetime-local" id="dataHoraLembrete">

<button id="btnAddEdit" class="btn-primary" onclick="adicionarLembrete()">Adicionar</button>

<div id="listaLembretes"></div>

<button class="btn-danger" onclick="logout()">Sair</button>
</div>


<script>
// -------------------- TEMA --------------------
function toggleTheme() {
  document.body.classList.toggle("dark");
  localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
}
if(localStorage.getItem("theme") === "dark") document.body.classList.add("dark");

// -------------------- NAVEGA√á√ÉO --------------------
function showScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.style.display = "none");
  document.getElementById(id).style.display = "block";
}

// -------------------- USU√ÅRIOS --------------------
let users = JSON.parse(localStorage.getItem("users")) || [];
let loggedUser = localStorage.getItem("loggedUser");

function register() {
  let u = regUser.value.trim();
  let p = regPass.value.trim();

  if(!u || !p) return alert("Preencha todos os campos!");
  if(users.some(x => x.user === u)) return alert("Usu√°rio j√° existe!");

  users.push({ user: u, pass: p });
  localStorage.setItem("users", JSON.stringify(users));
  alert("Cadastro realizado!");
  showScreen("loginScreen");
}

function login() {
  let u = loginUser.value.trim();
  let p = loginPass.value.trim();

  let exists = users.find(x => x.user === u && x.pass === p);
  if(!exists) return alert("Credenciais inv√°lidas!");

  loggedUser = u;
  localStorage.setItem("loggedUser", u);
  showScreen("mainScreen");
  renderizarLembretes();
}

function logout() {
  loggedUser = null;
  localStorage.removeItem("loggedUser");
  showScreen("loginScreen");
}

if(loggedUser) showScreen("mainScreen");

// -------------------- SENHA VISUAL --------------------
function togglePassword(inputId, eyeIcon) {
  let input = document.getElementById(inputId);
  if(input.type === "password") {
    input.type = "text";
    eyeIcon.textContent = "üôà";
  } else {
    input.type = "password";
    eyeIcon.textContent = "üëÅ";
  }
}

// -------------------- NOTIFICA√á√ïES --------------------
function pedirPermissao() {
  if("Notification" in window && Notification.permission === "default") {
    Notification.requestPermission();
  }
}
pedirPermissao();

function enviarNotificacao(titulo, msg) {
  if("Notification" in window && Notification.permission === "granted") {
    new Notification(titulo, { body: msg });
  } else {
    alert(`${titulo}\n\n${msg}`);
  }
}

// -------------------- LEMBRETES --------------------
let lembretes = JSON.parse(localStorage.getItem("lembretes")) || [];
let editId = null;

function salvarLembretes() {
  localStorage.setItem("lembretes", JSON.stringify(lembretes));
  renderizarLembretes();
}

function adicionarLembrete() {
  let titulo = tituloLembrete.value.trim();
  let dataHora = dataHoraLembrete.value;

  if(!titulo || !dataHora) return alert("Preencha o t√≠tulo e data!");

  if(editId === null) {
    lembretes.push({ id: Date.now(), user: loggedUser, titulo, dataHora, notificado:false });
  } else {
    let l = lembretes.find(x => x.id === editId);
    l.titulo = titulo;
    l.dataHora = dataHora;
    editId = null;
    btnAddEdit.textContent = "Adicionar";
  }

  salvarLembretes();
  tituloLembrete.value = "";
  dataHoraLembrete.value = "";
}

function editar(id) {
  let l = lembretes.find(x => x.id === id);
  tituloLembrete.value = l.titulo;
  dataHoraLembrete.value = l.dataHora;
  editId = id;
  btnAddEdit.textContent = "Salvar Edi√ß√£o";
}

function deletar(id) {
  lembretes = lembretes.filter(l => l.id !== id);
  salvarLembretes();
}

function renderizarLembretes() {
  let lista = document.getElementById("listaLembretes");
  lista.innerHTML = "";

  lembretes.filter(l => l.user === loggedUser).forEach(l => {
    let div = document.createElement("div");
    div.className = "reminder";
    div.innerHTML = `
      <b>${l.titulo}</b><br>
      ${new Date(l.dataHora).toLocaleString()}<br><br>
      <button class="btn-edit" onclick="editar(${l.id})">Editar</button>
      <button class="btn-danger" onclick="deletar(${l.id})">Excluir</button>
    `;
    lista.appendChild(div);
  });
}

// Verificar lembretes a cada 10s
setInterval(() => {
  let agora = new Date();
  lembretes.forEach(l => {
    if(!l.notificado && new Date(l.dataHora) <= agora) {
      enviarNotificacao("Lembrete de Sa√∫de", l.titulo);
      l.notificado = true;
      salvarLembretes();
    }
  });
}, 10000);

</script>
</body>
</html>
